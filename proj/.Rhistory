geom_errorbar(aes(ymin=lb, ymax=ub)) +
coord_flip() +
theme_bw() +
scale_y_continuous(name = "Final Polling Average", limits = c(0.25, 0.75), labels = scales::percent) +
scale_x_continuous(name = "Observed Seats Won", limits = c(0.4, 0.6), labels = scales::percent) +
geom_line(data = lobf, aes(y = x, x = line), color = "blue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = x), color = "red", linetype = "dashed") +
geom_ribbon(data = lobf, aes(ymin = lb, ymax = ub))
ggplot(dat, aes(y=guess, x=twoway_seat)) +
geom_point() +
geom_errorbar(aes(ymin=lb, ymax=ub)) +
coord_flip() +
theme_bw() +
scale_y_continuous(name = "Final Polling Average", limits = c(0.25, 0.75), labels = scales::percent) +
scale_x_continuous(name = "Observed Seats Won", limits = c(0.4, 0.6), labels = scales::percent) +
geom_line(data = lobf, aes(y = x, x = line), color = "blue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = x), color = "red", linetype = "dashed")
View(lobf)
ggplot(dat, aes(y=guess, x=twoway_seat)) +
geom_point() +
geom_errorbar(aes(ymin=lb, ymax=ub)) +
coord_flip() +
theme_bw() +
scale_y_continuous(name = "Final Polling Average", limits = c(0.25, 0.75), labels = scales::percent) +
scale_x_continuous(name = "Observed Seats Won", limits = c(0.4, 0.6), labels = scales::percent) +
geom_line(data = lobf, aes(y = x, x = line), color = "blue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = x), color = "red", linetype = "dashed") +
geom_ribbon(data = lobf, aes(x=x, ymin = lb, ymax = ub))
ggplot(dat, aes(y=guess, x=twoway_seat)) +
geom_point() +
geom_errorbar(aes(ymin=lb, ymax=ub)) +
coord_flip() +
theme_bw() +
scale_y_continuous(name = "Final Polling Average", limits = c(0.25, 0.75), labels = scales::percent) +
scale_x_continuous(name = "Observed Seats Won", limits = c(0.4, 0.6), labels = scales::percent) +
geom_line(data = lobf, aes(y = x, x = line), color = "blue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = lb), color = "lightblue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = ub), color = "lightblue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = x), color = "red", linetype = "dashed")
dat <- final_guess %>%
inner_join(res, by = "cycle") %>%
select(guess, twoway_seat, lb, ub)
x <- seq(0.25, 0.75, 0.001)
lobf <- data.frame(lb = param_est[1,"lb"] + param_est[2,"lb"]*x,
line = param_est[1,"guess"] + param_est[2,"guess"]*x,
ub = param_est[1,"ub"] + param_est[2,"ub"]*x,
x = x)
ggplot(dat, aes(y=guess, x=twoway_seat)) +
geom_point() +
geom_errorbar(aes(ymin=lb, ymax=ub)) +
coord_flip() +
theme_bw() +
scale_y_continuous(name = "Final Polling Average", limits = c(0, 1), labels = scales::percent) +
scale_x_continuous(name = "Observed Seats Won", limits = c(0, 1), labels = scales::percent) +
geom_line(data = lobf, aes(y = x, x = line), color = "blue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = lb), color = "lightblue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = ub), color = "lightblue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = x), color = "red", linetype = "dashed")
dat <- final_guess %>%
inner_join(res, by = "cycle") %>%
select(guess, twoway_seat, lb, ub)
x <- seq(0.25, 0.75, 0.001)
lobf <- data.frame(lb = param_est[1,"lb"] + param_est[2,"lb"]*x,
line = param_est[1,"guess"] + param_est[2,"guess"]*x,
ub = param_est[1,"ub"] + param_est[2,"ub"]*x,
x = x)
ggplot(dat, aes(y=guess, x=twoway_seat)) +
geom_point() +
geom_errorbar(aes(ymin=lb, ymax=ub)) +
coord_flip() +
theme_bw() +
scale_y_continuous(name = "Final Polling Average", limits = c(-2, 2), labels = scales::percent) +
scale_x_continuous(name = "Observed Seats Won", limits = c(-2, 2), labels = scales::percent) +
geom_line(data = lobf, aes(y = x, x = line), color = "blue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = lb), color = "lightblue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = ub), color = "lightblue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = x), color = "red", linetype = "dashed")
dat <- final_guess %>%
inner_join(res, by = "cycle") %>%
select(guess, twoway_seat, lb, ub)
x <- seq(0.25, 0.75, 0.001)
lobf <- data.frame(lb = param_est[1,"lb"] + param_est[2,"lb"]*x,
line = param_est[1,"guess"] + param_est[2,"guess"]*x,
ub = param_est[1,"ub"] + param_est[2,"ub"]*x,
x = x)
ggplot(dat, aes(y=guess, x=twoway_seat)) +
geom_point() +
geom_errorbar(aes(ymin=lb, ymax=ub)) +
coord_flip() +
theme_bw() +
scale_y_continuous(name = "Final Polling Average", limits = c(0.25, 0.75), labels = scales::percent) +
scale_x_continuous(name = "Observed Seats Won", limits = c(0.4, 0.6), labels = scales::percent) +
geom_line(data = lobf, aes(y = x, x = line), color = "blue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = x), color = "red", linetype = "dashed")
final_guess <- rbind(final_guess_06,
final_guess_08,
final_guess_10,
final_guess_12,
final_guess_14,
final_guess_16)
dat <- final_guess %>%
inner_join(res, by = "cycle") %>%
select(guess, twoway_seat)
mod_string = " model {
for (i in 1:length(twoway_seat)) {
twoway_seat[i] ~ dnorm(mu[i], prec)
logit(mu[i]) = b0 + b1*guess[i]
}
prec ~ dgamma(1.0/2.0, 1.0/2.0)
sig2 = 1.0 / prec
sig = sqrt(sig2)
b0 ~ dnorm(0, 1.0/0.5)
b1 ~ dnorm(1, 1.0/1.0)
} "
data_jags = as.list(dat)
params = c("b0", "b1", "sig")
mod = jags.model(textConnection(mod_string), data=data_jags, n.chains=3)
update(mod, 1e3)
mod_sim = coda.samples(model=mod,
variable.names=params,
n.iter=5e5,
thin = 10)
gelman.diag(mod_sim)
autocorr.diag(mod_sim)
summary(mod_sim)
param_est <- data.frame(param = c("b0", "b1"),
lb = c(-1.3213, -0.9698),
guess = c(-0.2111, 0.8041),
ub = c(0.9713, 2.6100))
dat <- final_guess %>%
inner_join(res, by = "cycle") %>%
select(guess, twoway_seat, lb, ub)
x <- seq(0.25, 0.75, 0.001)
lobf <- data.frame(lb = (1.0 / (1.0 + exp(-(param_est[1,"lb"] + param_est[2,"lb"]*x)))),
line = (1.0 / (1.0 + exp(-(param_est[1,"guess"] + param_est[2,"guess"]*x)))),
ub = (1.0 / (1.0 + exp(-(param_est[1,"ub"] + param_est[2,"ub"]*x)))),
x = x)
View(lobf)
ggplot(dat, aes(y=guess, x=twoway_seat)) +
geom_point() +
geom_errorbar(aes(ymin=lb, ymax=ub)) +
coord_flip() +
theme_bw() +
scale_y_continuous(name = "Final Polling Average", limits = c(0.25, 0.75), labels = scales::percent) +
scale_x_continuous(name = "Observed Seats Won", limits = c(0.4, 0.6), labels = scales::percent) +
geom_line(data = lobf, aes(y = x, x = line), color = "blue", linetype = "dashed") +
geom_line(data = lobf, aes(y = x, x = x), color = "red", linetype = "dashed")
-0.2010 + 0.8092*0.25
1/(1+exp(-0.0013))
test <- read.csv("test_dat.csv")
test$twoway <- test$dem/(test$dem+test$rep)
View(polls)
test$twoway <- test$dem/(test$dem+test$rep)
test <- test %>%
mutate(week = -round(as.numeric((as.Date(as.character(end_date),  format="%m/%d/%y") -
as.Date(as.character("11/6/18"),  format="%m/%d/%y")) +
(as.Date(as.character(start_date),  format="%m/%d/%y") -
as.Date(as.character(end_date),  format="%m/%d/%y"))/2)/7))
test$n_size <- as.numeric(as.character(test$n_size))
View(test)
View(delta_avgs)
test <- read.csv("test_dat.csv")
test$twoway <- test$dem/(test$dem+test$rep)
test <- test %>%
mutate(week = -round(as.numeric((as.Date(as.character(end_date),  format="%m/%d/%y") -
as.Date(as.character("11/6/18"),  format="%m/%d/%y")) +
(as.Date(as.character(start_date),  format="%m/%d/%y") -
as.Date(as.character(end_date),  format="%m/%d/%y"))/2)/7),
n_size = as.numeric(as.character(test$n_size))) %>%
filter(pollster %in% delta_avgs$pollster)
View(test)
dat <- test
dat$pollster_num <- as.numeric(as.factor(as.character(dat$pollster)))
dat$univ_num <- as.numeric(dat$univ)
dat$prec <- 1/(sqrt((dat$twoway*(1-dat$twoway))/dat$n_size))
dat$week_adj <- -1*(dat$week - max(dat$week)) + 2
xi <- rep(NA, max(length(unique(dat$week_adj)),max(dat$week_adj))+1)
data_jags = as.list(dat)
data_jags$xi <- xi
delta_2018 <- data.frame(pollster = unique(dat$pollster))
delta_2018
View(delta_2018)
delta_2018 <- data.frame(pollster = unique(dat$pollster))
delta_2018 <- delta_2018 %>% left_join(delta_avgs, by = "pollster")
View(delta_2018)
data_jags$delta <- delta_2018$avg_bias
theta_2018 <- data.frame(univ = unique(dat$univ))
theta_2018 <- theta_2018 %>% left_join(theta_avgs, by = "univ")
data_jags$theta <- theta_2018$avg_bias
mod_string = " model {
xi[1] ~ dunif(0.46, 0.56)
for(i in 1:length(twoway)){
mu[i] <- xi[week_adj[i]] + delta[pollster_num[i]] + theta[univ_num[i]]
twoway[i] ~ dnorm(mu[i],prec[i])
}
for(t in 2:length(xi)){
xi[t] ~ dnorm(xi[t-1],tau)
}
## priors for standard deviations
omega2 ~ dgamma(1.0/2.0,1.0/2.0) I(0.001, 0.999)
tau <- 1/omega2
} "
params = c("xi")
mod = jags.model(textConnection(mod_string), data=data_jags, n.chains=3)
update(mod, 1000) # burn-in
mod_sim = coda.samples(model=mod,
variable.names=params,
n.iter=250000,
thin = 9)
summary(mod_sim)
View(param_est)
final_guess <- rbind(final_guess_06,
final_guess_08,
final_guess_10,
final_guess_12,
final_guess_14,
final_guess_16)
dat <- final_guess %>%
inner_join(res, by = "cycle") %>%
select(guess, twoway_seat)
mod_string = " model {
for (i in 1:length(twoway_seat)) {
twoway_seat[i] ~ dnorm(mu[i], prec)
mu[i] = b0 + b1*guess[i]
}
prec ~ dgamma(1.0/2.0, 1.0/2.0)
sig2 = 1.0 / prec
sig = sqrt(sig2)
b0 ~ dnorm(0, 1.0/0.5)
b1 ~ dnorm(1, 1.0/1.0)
} "
data_jags = as.list(dat)
params = c("b0", "b1", "sig")
mod = jags.model(textConnection(mod_string), data=data_jags, n.chains=3)
update(mod, 1e3)
mod_sim = coda.samples(model=mod,
variable.names=params,
n.iter=5e5,
thin = 10)
gelman.diag(mod_sim)
autocorr.diag(mod_sim)
summary(mod_sim)
param_est <- data.frame(param = c("b0", "b1"),
lb = c(-0.8498, -0.5886),
guess = c(-0.0179, 0.9954),
ub = c(0.8167, 2.5859))
View(param_est)
-0.0179 + 0.9954*0.5407
0.5203128* 435
(-0.0179 + 0.9954*0.4230)*435
(-0.0179 + 0.9954*0.6601)*435
mod_csim = as.mcmc(do.call(rbind, mod_sim))
x <- data.frame(eighteen = colMeans(mod_csim))
delta_2006 <- x %>% filter(substr(row.names(x),1,1) == 'x')
xi_2018 <- x %>% filter(substr(row.names(x),1,1) == 'x')
View(xi_2018)
x <- data.frame(eighteen = colMeans(mod_csim))
View(x)
test <- read.csv("test_dat.csv")
test$twoway <- test$dem/(test$dem+test$rep)
test <- test %>%
mutate(week = -round(as.numeric((as.Date(as.character(end_date),  format="%m/%d/%y") -
as.Date(as.character("11/6/18"),  format="%m/%d/%y")) +
(as.Date(as.character(start_date),  format="%m/%d/%y") -
as.Date(as.character(end_date),  format="%m/%d/%y"))/2)/7),
n_size = as.numeric(as.character(test$n_size))) %>%
filter(pollster %in% delta_avgs$pollster)
dat <- test
dat$pollster_num <- as.numeric(as.factor(as.character(dat$pollster)))
dat$univ_num <- as.numeric(dat$univ)
dat$prec <- 1/(sqrt((dat$twoway*(1-dat$twoway))/dat$n_size))
dat$week_adj <- -1*(dat$week - max(dat$week)) + 2
xi <- rep(NA, max(length(unique(dat$week_adj)),max(dat$week_adj))+1)
data_jags = as.list(dat)
data_jags$xi <- xi
delta_2018 <- data.frame(pollster = unique(dat$pollster))
delta_2018 <- delta_2018 %>% left_join(delta_avgs, by = "pollster")
data_jags$delta <- delta_2018$avg_bias
theta_2018 <- data.frame(univ = unique(dat$univ))
theta_2018 <- theta_2018 %>% left_join(theta_avgs, by = "univ")
data_jags$theta <- theta_2018$avg_bias
mod_string = " model {
xi[1] ~ dunif(0.46, 0.56)
for(i in 1:length(twoway)){
mu[i] <- xi[week_adj[i]] + delta[pollster_num[i]] + theta[univ_num[i]]
twoway[i] ~ dnorm(mu[i],prec[i])
}
for(t in 2:length(xi)){
xi[t] ~ dnorm(xi[t-1],tau)
}
## priors for standard deviations
omega2 ~ dgamma(1.0/2.0,1.0/2.0) I(0.001, 0.999)
tau <- 1/omega2
} "
params = c("xi")
mod = jags.model(textConnection(mod_string), data=data_jags, n.chains=3)
update(mod, 1000) # burn-in
mod_sim = coda.samples(model=mod,
variable.names=params,
n.iter=250000,
thin = 9)
summary(mod_sim)
final_guess_18 <- data.frame(cycle = 2018,
lb = c(0.4230),
guess = c(0.5407),
ub = c(0.6601))
mod_csim = as.mcmc(do.call(rbind, mod_sim))
x <- data.frame(eighteen = colMeans(mod_csim))
xi_2018 <- x %>% filter(substr(row.names(x),1,1) == 'x')
View(xi_2018)
xi_2018$week_adj <- seq(1,nrowxi_2018,1)
xi_2018$week_adj <- seq(1,nrow(xi_2018,1))
xi_2018$week_adj <- seq(1,nrow(xi_2018),1)
View(xi_2018)
View(dat)
ggplot(xi_2018, aes(x = week_adj, y = eighteen)) + geom_line()
test <- read.csv("test_dat.csv")
test$twoway <- test$dem/(test$dem+test$rep)
test <- test %>%
mutate(week = -round(as.numeric((as.Date(as.character(end_date),  format="%m/%d/%y") -
as.Date(as.character("11/6/18"),  format="%m/%d/%y")) +
(as.Date(as.character(start_date),  format="%m/%d/%y") -
as.Date(as.character(end_date),  format="%m/%d/%y"))/2)/7),
week_temp = -(as.numeric((as.Date(as.character(end_date),  format="%m/%d/%y") -
as.Date(as.character("11/6/18"),  format="%m/%d/%y")) +
(as.Date(as.character(start_date),  format="%m/%d/%y") -
as.Date(as.character(end_date),  format="%m/%d/%y"))/2)/7),
n_size = as.numeric(as.character(test$n_size))) %>%
filter(pollster %in% delta_avgs$pollster)
dat <- test
dat$pollster_num <- as.numeric(as.factor(as.character(dat$pollster)))
dat$univ_num <- as.numeric(dat$univ)
dat$prec <- 1/(sqrt((dat$twoway*(1-dat$twoway))/dat$n_size))
dat$week_adj <- -1*(dat$week - max(dat$week)) + 2
dat$week_temp_adj <- -1*(dat$week_temp - max(dat$week_temp)) + 2
xi <- rep(NA, max(length(unique(dat$week_adj)),max(dat$week_adj))+1)
data_jags = as.list(dat)
data_jags$xi <- xi
delta_2018 <- data.frame(pollster = unique(dat$pollster))
delta_2018 <- delta_2018 %>% left_join(delta_avgs, by = "pollster")
data_jags$delta <- delta_2018$avg_bias
theta_2018 <- data.frame(univ = unique(dat$univ))
theta_2018 <- theta_2018 %>% left_join(theta_avgs, by = "univ")
data_jags$theta <- theta_2018$avg_bias
ggplot(xi_2018, aes(x = week_adj, y = eighteen)) +
geom_line() +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway))
ggplot(xi_2018, aes(x = week_adj, y = eighteen)) +
geom_line() +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway, size=sqrt(n_size)))
ggplot(xi_2018, aes(x = week_adj, y = eighteen)) +
geom_line() +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.6), labels = scales::percent)
ggplot(xi_2018, aes(x = week_adj, y = eighteen)) +
geom_line() +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.6), labels = scales::percent) +
scale_x_continuous(name = "Weeks before 2018 Election", lables = c(95, 85, 75, 65, 55, 45))
ggplot(xi_2018, aes(x = week_adj, y = eighteen)) +
geom_line() +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.6), labels = scales::percent) +
scale_x_continuous(name = "Weeks before 2018 Election")
?scale_x_continuous
ggplot(xi_2018, aes(x = week_adj, y = eighteen)) +
geom_line() +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.6), labels = scales::percent) +
scale_x_continuous(name = "Weeks before 2018 Election" , breaks = c(0, 10, 20, 30, 40, 50), lables = c(95, 85, 75, 65, 55, 45))
ggplot(xi_2018, aes(x = week_adj, y = eighteen)) +
geom_line() +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.6), labels = scales::percent) +
scale_x_continuous(name = "Weeks before 2018 Election" , labels = c(95, 85, 75, 65, 55, 45))
summary(mod_sim)$2
summary(mod_sim)
sum <- summary(mod_sim)
sum$quantiles
df <- sum$quantiles
View(df)
names(df)
df <- as.data.frame(sum$quantiles)
View(df)
names(df)
names(df) <- c("llb", "lb", "mean", "ub", "uub")
xi_2018 <- df
xi_2018$week_adj <- seq(1,nrow(xi_2018),1)
View(xi_2018)
ggplot(xi_2018, aes(x = week_adj, y = mean)) +
geom_ribbon(aes(ymin=llb,ymax=uub)) +
geom_line() +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.6), labels = scales::percent) +
scale_x_continuous(name = "Weeks before 2018 Election" , labels = c(95, 85, 75, 65, 55, 45))
ggplot(xi_2018, aes(x = week_adj, y = mean)) +
geom_ribbon(aes(ymin=llb,ymax=uub)) +
geom_line() +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.7), labels = scales::percent) +
scale_x_continuous(name = "Weeks before 2018 Election" , labels = c(95, 85, 75, 65, 55, 45))
?geom_ribbon
ggplot(xi_2018, aes(x = week_adj, y = mean)) +
geom_ribbon(aes(ymin=llb,ymax=uub), alpha = 0.5) +
geom_line() +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.7), labels = scales::percent) +
scale_x_continuous(name = "Weeks before 2018 Election" , labels = c(95, 85, 75, 65, 55, 45))
ggplot(xi_2018, aes(x = week_adj, y = mean)) +
geom_ribbon(aes(ymin=llb,ymax=uub), alpha = 0.5) +
geom_line(color = "blue") +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.7), labels = scales::percent) +
scale_x_continuous(name = "Weeks before 2018 Election" , labels = c(95, 85, 75, 65, 55, 45))
ggplot(xi_2018, aes(x = week_adj, y = mean)) +
geom_ribbon(aes(ymin=llb,ymax=uub), alpha = 0.5) +
geom_line(color = "blue") +
theme_bw() +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.67), labels = scales::percent) +
scale_x_continuous(name = "Weeks before 2018 Election" , labels = c(95, 85, 75, 65, 55, 45))
View(theta_avgs)
ggplot(xi_2018, aes(x = week_adj, y = mean)) +
geom_ribbon(aes(ymin=llb,ymax=uub), alpha = 0.5) +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
geom_line(color = "blue") +
theme_bw() +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.67), labels = scales::percent) +
scale_x_continuous(name = "Weeks before 2018 Election" , labels = c(95, 85, 75, 65, 55, 45))
test <- read.csv("test_dat.csv")
test$twoway <- test$dem/(test$dem+test$rep)
test <- test %>%
mutate(week = -round(as.numeric((as.Date(as.character(end_date),  format="%m/%d/%y") -
as.Date(as.character("11/6/18"),  format="%m/%d/%y")) +
(as.Date(as.character(start_date),  format="%m/%d/%y") -
as.Date(as.character(end_date),  format="%m/%d/%y"))/2)/7),
week_temp = -(as.numeric((as.Date(as.character(end_date),  format="%m/%d/%y") -
as.Date(as.character("11/6/18"),  format="%m/%d/%y")) +
(as.Date(as.character(start_date),  format="%m/%d/%y") -
as.Date(as.character(end_date),  format="%m/%d/%y"))/2)/7),
n_size = as.numeric(as.character(test$n_size))) %>%
filter(pollster %in% delta_avgs$pollster)
dat <- test
dat$pollster_num <- as.numeric(as.factor(as.character(dat$pollster)))
dat$univ_num <- as.numeric(dat$univ)
dat$prec <- 1/(sqrt((dat$twoway*(1-dat$twoway))/dat$n_size))
dat$week_adj <- -1*(dat$week - max(dat$week)) + 2
dat$week_temp_adj <- -1*(dat$week_temp - max(dat$week_temp)) + 2
xi <- rep(NA, max(length(unique(dat$week_adj)),max(dat$week_adj))+1)
data_jags = as.list(dat)
data_jags$xi <- xi
delta_2018 <- data.frame(pollster = unique(dat$pollster))
delta_2018 <- delta_2018 %>% left_join(delta_avgs, by = "pollster")
data_jags$delta <- delta_2018$avg_bias
theta_2018 <- data.frame(univ = unique(dat$univ))
theta_2018 <- theta_2018 %>% left_join(theta_avgs, by = "univ")
data_jags$theta <- theta_2018$avg_bias
mod_string = " model {
xi[1] ~ dunif(0.46, 0.56)
for(i in 1:length(twoway)){
mu[i] <- xi[week_adj[i]] + delta[pollster_num[i]] + theta[univ_num[i]]
twoway[i] ~ dnorm(mu[i],prec[i])
}
for(t in 2:length(xi)){
xi[t] ~ dnorm(xi[t-1],tau)
}
## priors for standard deviations
omega2 ~ dgamma(1.0/2.0,1.0/2.0) I(0.001, 0.999)
tau <- 1/omega2
} "
params = c("xi")
mod = jags.model(textConnection(mod_string), data=data_jags, n.chains=3)
update(mod, 1000) # burn-in
mod_sim = coda.samples(model=mod,
variable.names=params,
n.iter=250000,
thin = 9)
sum <- summary(mod_sim)
df <- as.data.frame(sum$quantiles)
names(df) <- c("llb", "lb", "mean", "ub", "uub")
final_guess_18 <- data.frame(cycle = 2018,
lb = c(0.4230),
guess = c(0.5407),
ub = c(0.6601))
xi_2018 <- df
xi_2018$week_adj <- seq(1,nrow(xi_2018),1)
ggplot(xi_2018, aes(x = week_adj, y = mean)) +
geom_ribbon(aes(ymin=llb,ymax=uub), alpha = 0.5) +
geom_point(data = dat, aes(x = week_temp_adj, y=twoway)) +
geom_line(color = "blue") +
theme_bw() +
scale_y_continuous(name = "Democratic two-way support", limits = c(0.4, 0.67), labels = scales::percent) +
scale_x_continuous(name = "Weeks before 2018 Election" , labels = c(95, 85, 75, 65, 55, 45))
``
final_guess_18$guess[1]
min_seats <- 435*(param_est[1,"guess"] + param_est[2,"guess"]*final_guess_18$lb[1])
mean_seats <- 435*(param_est[1,"guess"] + param_est[2,"guess"]*final_guess_18$guess[1])
max_seats <- 435*(param_est[1,"guess"] + param_est[2,"guess"]*final_guess_18$ub[1])
min_seats
mean_seats
max_seats
